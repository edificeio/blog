import{b as j,r as m,ap as f,p as u,j as s,aq as y,ar as N,as as v,d as B,s as P,A as F,am as D,an as I,at as L,au as S,Y as T}from"./index-XY-EGNwC.js";import{u as E,a as $,b as x,c as p,d as h,m as w,e as M}from"./index-fCB84Be-.js";import"/assets/js/edifice-ts-client/index.js";const Q=()=>{const{t}=j(),[e,l]=m.useState({states:[],search:""}),r=f(e,500),{setPostsFilter:n}=E(),{counters:a}=$(),d=i=>{const c=i.target.value;l({...e,search:c.toString()})},o=i=>{let c=e.states.includes(i)?e.states.filter(g=>g!==i):[...e.states,i];c.length===3&&(c=[]),l({...e,states:c})};m.useEffect(()=>{n(e)},[r]);const b=[{type:"button",name:"published",props:{className:u({"bg-primary-200 selected":e.states.includes("PUBLISHED")}),children:s.jsxs("span",{children:[s.jsxs("span",{children:[t("Publiés")," "]}),a==null?void 0:a.countPublished]}),onClick:()=>{o("PUBLISHED")}}},{type:"button",name:"submitted",props:{className:u({"bg-primary-200 selected":e.states.includes("SUBMITTED")}),children:s.jsxs(s.Fragment,{children:[s.jsxs("span",{children:[t("À valider")," "]}),a==null?void 0:a.countSubmitted]}),onClick:()=>{o("SUBMITTED")}}},{type:"button",name:"draft",props:{className:u({"bg-primary-200 selected":e.states.includes("DRAFT")}),children:s.jsxs(s.Fragment,{children:[s.jsxs("span",{children:[t("Brouillons")," "]}),a==null?void 0:a.countDraft]}),onClick:()=>{o("DRAFT")}}}];return s.jsxs("div",{className:"d-flex pb-16",children:[s.jsx(y,{isVariant:!0,className:"flex-fill",onChange:d,placeholder:t("Rechercher un billet ou un auteur"),size:"md"}),s.jsx(N,{variant:"no-shadow",className:"ms-16 ps-4 py-2 border border-primary-200 rounded-3 blog-filter-toolbar",items:b})]})},A=({list:t,onClick:e})=>{const{formatDate:l}=v(),r=a=>l(a,"D MMMM YYYY"),n=a=>{e==null||e(a)};return s.jsx("div",{className:"pt-8",children:t.map(a=>s.jsxs("div",{className:"pb-8 d-flex summary-list-item",onClick:()=>{n(a)},role:"button",tabIndex:0,children:[s.jsx("div",{className:"summary-list-item-symbole text-primary",children:s.jsx("div",{className:"summary-list-item-symbole-circle"})}),s.jsxs("div",{className:"flex-fill",children:[s.jsx("div",{children:a.title}),s.jsx("em",{className:"small text-gray-700",children:a.date&&r(a.date)})]})]},a.id))})},C=()=>{const{blog:t}=x(),{posts:e}=p(),{currentApp:l}=B();return s.jsxs("div",{className:" d-none d-lg-block col-3 py-16 pe-16 border-end",children:[t!=null&&t.thumbnail?s.jsx(P,{src:t.thumbnail,alt:t.title,objectFit:"cover",className:"h-auto w-100 rounded"}):s.jsx(F,{app:l,iconFit:"ratio",size:"80",variant:"rounded"}),e&&s.jsx(A,{list:e.map(r=>{var n;return{id:r._id,title:r.title,date:(n=r.modified)==null?void 0:n.$date}})})]})},U=()=>{const{posts:t}=p();return s.jsxs("div",{className:"d-flex flex-fill",children:[s.jsx(C,{}),s.jsxs("div",{className:"col-9 py-16 ps-16",children:[s.jsx(Q,{}),s.jsx("h1",{children:"List of posts"}),t==null?void 0:t.map(e=>s.jsx("div",{className:"pb-8",children:s.jsx("div",{children:e.title})},e._id))]})]})},Y=()=>{const t=D(),{data:e}=I(h(t.blogId));return s.jsx(L,{children:s.jsx(S,{app:{address:"/blog",display:!1,displayName:"Blog",icon:"",isExternal:!1,name:"",scope:[]},name:e==null?void 0:e.title})})},k=t=>async({params:e})=>{const l=h(e.blogId),r=w(e.blogId),n=M(e.blogId),a=await t.fetchQuery(l),d=await t.fetchInfiniteQuery(r),o=await t.fetchQuery(n);return{blog:a,postsList:d,blogCounter:o}};function z(){const{blog:t}=x(),{posts:e,query:{fetchNextPage:l,hasNextPage:r,status:n}}=p();return m.useEffect(()=>{n==="success"&&r&&l()},[n,r,l]),!t&&!e?s.jsx(T,{}):s.jsxs(s.Fragment,{children:[s.jsx(Y,{}),s.jsx(U,{})]})}export{z as Blog,k as blogLoader};
