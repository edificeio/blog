import{d as re,b as G,_ as J,a3 as oe,a4 as ie,a5 as ce,j as s,i as le,a6 as de,B as K,r as f,Y as ue,Z as he,$ as pe,a7 as fe,a8 as Ee,a9 as Se,W as Re,X as ge,K as me,J as ve,o as z,aa as _e,ab as be,n as Oe,S as W,e as ye,a0 as P,ac as xe,ad as Pe,ae as Ae}from"./index-XY-EGNwC.js";import{ACTION as u,odeServices as j}from"/assets/js/edifice-ts-client/index.js";function Ce({roles:n,rights:t,action:o}){const[h,a]=f.useState(!1),{user:m}=xe(),E=z();f.useEffect(()=>{R()},[n,t]);const S=async function(c){const r=c instanceof Array?c:[c];if(n instanceof Array){const p=await j.rights().sessionHasAtLeastOneResourceRight(n,r);a(p)}else{const p=await j.rights().sessionHasResourceRight(n,r);a(p)}},i=async function(c){if(n instanceof Array){const r=await j.rights().sessionHasAtLeastOneResourceRightForEachList(n,c);a(r)}else{const r=await j.rights().sessionHasResourceRightForEachList(n,c);a(r)}},R=async function(){var c,r,p;if(n===void 0){a(!0);return}if(E&&(r=(c=t[0])==null?void 0:c.trashedBy)!=null&&r.includes(m==null?void 0:m.userId)&&o==="restore"&&!((p=t[0])!=null&&p.trashed)){a(!0);return}if(t instanceof Array)if(t.length>0)if(typeof t[0]=="string")await S(t);else{const v=t.map(_=>_.rights);await i(v)}else a(!1);else typeof t=="string"?await S(t):await S(t.rights)};return{visible:h,refreshState:R}}function Q(){const[n,t]=f.useState(!1),[o,h]=f.useState("void"),[a,m]=f.useState(),E=Se(e=>e.config),S=Re(),i=ge(),R=J(),c=me(),r=ve(),p=z(),v=_e(),_=be(),b=Oe(),{openResource:L,printSelectedResource:D,openFolder:M,clearSelectedItems:B,clearSelectedIds:F}=W(),{data:T}=ye();f.useEffect(()=>{if(i.length===0&&r.length===0){t(!1);return}if(_){t(!1);return}t(!0)},[i,r]);async function $(e){var I;switch((I=document.getElementById("root"))==null||I.setAttribute("aria-hidden","true"),m(e),e.id){case u.OPEN:return i.length>0?L(R[0]):M({folder:c[0],folderId:c[0].id});case u.MOVE:return h("move");case u.PRINT:return D();case u.DELETE:return h("delete");case u.RESTORE:return await A();case u.PUBLISH:return h("publish");case u.UPD_PROPS:case"edit":return te();case"export":return ne();case u.SHARE:return h("share");default:throw Error(`Unknown action: ${e.id}`)}}function k(e){const I=i.length+r.length,x=i.length===1||r.length===1,Y=I===1,w=r.length===0;switch(e.id){case u.OPEN:return Y;case u.MANAGE:return x;case u.PUBLISH:return x&&w;case u.UPD_PROPS:return x&&w;case u.SHARE:return w&&x;case u.PRINT:return x&&w;case"edit":return Y;default:return!0}}const H=()=>!0;async function A(){try{if(p)await v.mutate();else throw new Error("Cannot restore untrashed resources");g()}catch(e){console.error(e)}}function g(){var e;h("void"),a!=null&&a.id&&((e=document.getElementById(a==null?void 0:a.id))==null||e.focus())}const d=e=>()=>{o===e&&(g(),B(),F())},C=d("move"),N=d("move"),O=d("delete"),y=d("delete"),l=d("publish"),U=d("publish"),V=d("edit_folder"),X=d("edit_folder"),Z=d("edit_resource"),q=d("edit_resource"),ee=d("share"),se=d("share");function te(){if(i&&i.length>0){const e=R[0].assetId;(E==null?void 0:E.app)=="scrapbook"?Pe({searchParams:b,assetId:e}):h("edit_resource")}else h("edit_folder")}function ne(){if(i&&i.length>0){const e=R[0].assetId;Ae({searchParams:b,assetId:e})}}function ae(e){return e.id==="edit"&&r.length>0?"explorer.rename":`explorer.actions.${e.id}`}return{onRestore:A,actions:p?E==null?void 0:E.trashActions:T,selectedElement:[...R,...c],currentFolderId:S==null?void 0:S.id,overrideLabel:ae,handleClick:$,isActivable:p?H:k,isActionBarOpen:n,isMoveModalOpen:o==="move",onMoveCancel:C,onMoveSuccess:N,isDeleteModalOpen:o==="delete",onDeleteCancel:y,onDeleteSuccess:O,isPublishModalOpen:o==="publish",onPublishCancel:U,onPublishSuccess:l,isEditFolderOpen:o==="edit_folder",onEditFolderCancel:X,onEditFolderSuccess:V,isEditResourceOpen:o==="edit_resource",onEditResourceCancel:q,onEditResourceSuccess:Z,isShareResourceOpen:o==="share",onShareResourceCancel:se,onShareResourceSuccess:ee,onClearActionBar:g}}function Ie({resourceRights:n,roleExpected:t,action:o,children:h,renderWhenForbidden:a}){const{t:m}=G(),{overrideLabel:E}=Q(),{visible:S}=Ce({roles:t,rights:n,action:o==null?void 0:o.id}),{setResourceActionDisable:i}=W(),R=z();return S?s.jsx(s.Fragment,{children:h}):a?a():R&&!S?s.jsx(K,{type:"button",color:"primary",variant:"filled",onClick:()=>{i(!0)},children:m(E(o))}):s.jsx(s.Fragment,{})}const we=f.lazy(async()=>await P(()=>import("./PublishModal-IR4nnbFH.js"),__vite__mapDeps([0,1,2]))),je=f.lazy(async()=>await P(()=>import("./ResourceModal-0014_dww.js"),__vite__mapDeps([3,1,2]))),Le=f.lazy(async()=>await P(()=>import("./DeleteModal-TAXPpZQw.js"),__vite__mapDeps([4,1,2]))),De=f.lazy(async()=>await P(()=>import("./MoveModal-uqmS7bpE.js"),__vite__mapDeps([5,1,2]))),Me=f.lazy(async()=>await P(()=>import("./FolderModal-wVdVjKWi.js"),__vite__mapDeps([6,1,2])));function Te(){const{appCode:n}=re(),{t}=G(),{actions:o,selectedElement:h,isMoveModalOpen:a,isDeleteModalOpen:m,isPublishModalOpen:E,isActionBarOpen:S,isEditFolderOpen:i,overrideLabel:R,onEditFolderCancel:c,onEditFolderSuccess:r,isEditResourceOpen:p,onEditResourceCancel:v,onEditResourceSuccess:_,isShareResourceOpen:b,onShareResourceCancel:L,onShareResourceSuccess:D,onMoveCancel:M,onMoveSuccess:B,onDeleteCancel:F,onDeleteSuccess:T,onPublishCancel:$,onPublishSuccess:k,isActivable:H,handleClick:A}=Q(),g=J()[0],d=oe(n),C=ie(n),N=ce(S,{from:{opacity:0,transform:"translateY(100%)"},enter:{opacity:1,transform:"translateY(0)"},leave:{opacity:0,transform:"translateY(100%)"}});return s.jsxs(s.Fragment,{children:[N((O,y)=>y&&s.jsx(le.div,{className:"position-fixed bottom-0 start-0 end-0 z-3",style:O,children:s.jsx(de,{children:o==null?void 0:o.filter(l=>l.available&&l.target==="actionbar").map(l=>H(l)&&s.jsx(Ie,{resourceRights:h,roleExpected:l.right,action:l,children:s.jsx(K,{id:l.id,type:"button",color:"primary",variant:"filled",onClick:()=>{A(l)},children:t(R(l))},l.id)},l.id))})})),s.jsxs(f.Suspense,{fallback:s.jsx(ue,{}),children:[a&&s.jsx(De,{isOpen:a,onCancel:M,onSuccess:B}),m&&s.jsx(Le,{isOpen:m,onCancel:F,onSuccess:T}),E&&g&&s.jsx(we,{isOpen:E,resourceId:g.assetId,onCancel:$,onSuccess:k}),i&&s.jsx(Me,{edit:!0,isOpen:i,onCancel:c,onSuccess:r}),p&&g&&s.jsx(je,{mode:"update",isOpen:p,resourceId:g.assetId,updateResource:C,onCancel:v,onSuccess:_,children:(O,y,l,U,V)=>n==="blog"&&he("createPublic",o)&&s.jsx(pe,{appCode:n,isUpdating:y,resource:O,watch:l,setValue:U,register:V})}),b&&g&&s.jsx(fe,{isOpen:b,resourceId:g.assetId,shareResource:d,onCancel:L,onSuccess:D,children:n==="blog"?s.jsx(Ee,{resource:g,updateResource:C}):null})]})]})}export{Te as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["public/PublishModal-IR4nnbFH.js","public/index-XY-EGNwC.js","public/index-I4KjTQ5m.css","public/ResourceModal-0014_dww.js","public/DeleteModal-TAXPpZQw.js","public/MoveModal-uqmS7bpE.js","public/FolderModal-wVdVjKWi.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
